From 2f8d074aa5e4fe46826c72f1a401abd562c294ae Mon Sep 17 00:00:00 2001
From: Olivier Brunel <jjk@jjacky.com>
Date: Tue, 15 Oct 2013 15:09:15 +0200
Subject: [PATCH] Fix scrolling menu not working properly; Bug #701077

The fix for #695120 introduced a new bug, where long menus didn't properly get
scrolling, as it removed not only the call to gtk_widget_size_allocate() but
also gtk_widget_queue_resize().

Signed-off-by: Olivier Brunel <jjk@jjacky.com>
---
 gtk/gtkmenu.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/gtk/gtkmenu.c b/gtk/gtkmenu.c
index acebe76..5991bcb 100644
--- a/gtk/gtkmenu.c
+++ b/gtk/gtkmenu.c
@@ -1705,6 +1705,9 @@ gtk_menu_popup_for_device (GtkMenu             *menu,
    */
   gtk_menu_position (menu, TRUE);
 
+  /* Ensure scrolling is done properly */
+  gtk_widget_queue_resize (GTK_WIDGET (menu));
+
   gtk_menu_scroll_to (menu, priv->scroll_offset);
 
   /* if no item is selected, select the first one */
-- 
1.9.1

