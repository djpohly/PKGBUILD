From 12a29520ab5072141d24dc31868fa25448474c83 Mon Sep 17 00:00:00 2001
From: Olivier Brunel <jjk@jjacky.com>
Date: Tue, 8 Oct 2013 16:59:16 +0200
Subject: [PATCH] gtkicontheme: Fallback to "regular" icons when symbolic ones
 aren't found

Signed-off-by: Olivier Brunel <jjk@jjacky.com>
---
 gtk/gtkicontheme.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/gtk/gtkicontheme.c b/gtk/gtkicontheme.c
index d912687..1a225a2 100644
--- a/gtk/gtkicontheme.c
+++ b/gtk/gtkicontheme.c
@@ -1897,12 +1897,12 @@ gtk_icon_theme_lookup_icon_for_scale (GtkIconTheme       *icon_theme,
 
       if (is_symbolic)
         {
-          names = g_new (gchar *, dashes + 2);
+          names = g_new (gchar *, 2 * (dashes + 1) + 1);
           for (i = 0; nonsymbolic_names[i] != NULL; i++)
             names[i] = g_strconcat (nonsymbolic_names[i], "-symbolic", NULL);
 
-          names[i] = NULL;
-          g_strfreev (nonsymbolic_names);
+          memcpy (names + i, nonsymbolic_names, sizeof (gchar *) * (dashes + 2));
+          g_free (nonsymbolic_names);
         }
       else
         {
-- 
1.8.4

