# $Id$
# Maintainer: Jan de Groot <jgc@archlinux.org>
# Contributor: Alexander Baldeck <alexander@archlinux.org>

_pkgname=xf86-video-ati
pkgname=$_pkgname-jjk
pkgver=7.8.0
pkgrel=2
pkgdesc="X.org ati video driver"
arch=('i686' 'x86_64')
url="https://xorg.freedesktop.org/"
license=('custom')
depends=('mesa')
makedepends=('xorg-server-devel' 'X-ABI-VIDEODRV_VERSION=23')
conflicts=('xorg-server<1.19.0' 'X-ABI-VIDEODRV_VERSION<23' 'X-ABI-VIDEODRV_VERSION>=24'
           $_pkgname)
provides=($_pkgname)
source=($url/releases/individual/driver/$_pkgname-$pkgver.tar.bz2{,.sig}
        failure-to-set-drm-master-is-not-fatal.patch)
md5sums=('f34d04a755e761e03b459155fa3ddcbb'
         'SKIP'
         '868acab0b4a71dfb1cab8f99d0e4c209')
validpgpkeys=('B09FAF35BE914521980951145A81AF8E6ADBB200') # Michel Daenzer <michel@daenzer.net>

prepare() {
    cd $_pkgname-$pkgver
    patch -p0 -i ../failure-to-set-drm-master-is-not-fatal.patch
}

build() {
  cd $_pkgname-$pkgver

  ./configure --prefix=/usr \
    --enable-glamor
  make
}

package() {
  cd $_pkgname-$pkgver

  make DESTDIR="$pkgdir" install
  install -m755 -d "$pkgdir/usr/share/licenses/$_pkgname"
  install -m644 COPYING "$pkgdir/usr/share/licenses/$_pkgname/"
}
